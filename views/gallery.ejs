<% layout('layout') %>

<section class="section" dir="rtl">
  <header class="card" style="display:grid; gap:10px;">
    <h1 style="margin:0">گالری نمونه‌کار</h1>
    <p class="text-[var(--muted)]" style="margin:0">برای هر بخش روی تب کلیک کنید.</p>

    <div class="tabs" role="tablist" aria-label="Gallery sections" style="display:flex; gap:6px; flex-wrap:wrap;">
      <% sections.forEach((s, i) => { %>
        <button class="tab-btn <%= i===0 ? 'active' : '' %>" data-target="<%= s.key %>" role="tab" aria-selected="<%= i===0 ? 'true' : 'false' %>"
                style="border:1px solid var(--border); background:#fff; padding:8px 12px; border-radius:999px; cursor:pointer;">
          <%= s.title %>
        </button>
      <% }) %>
    </div>
  </header>
</section>

<section class="section" dir="rtl">
  <% sections.forEach((s, i) => { %>
    <div class="gallery-grid <%= i===0 ? 'show' : 'hide' %>" data-section="<%= s.key %>">
      <div class="cards" style="display:grid; grid-template-columns:repeat(auto-fill,minmax(180px,1fr)); gap:10px;">
        <% (photos[s.key] || []).forEach(src => { %>
          <figure class="card" style="padding:8px;">
            <a href="<%= src %>" target="_blank" rel="noopener" style="display:block">
              <img src="<%= src %>" alt="<%= s.title %>" loading="lazy"
                   style="width:100%; height:180px; object-fit:cover; border-radius:8px;" />
            </a>
          </figure>
        <% }) %>
        <% if (!(photos[s.key] || []).length) { %>
          <div class="card" style="text-align:center; padding:20px;">به زودی تصاویر این بخش اضافه می‌شود.</div>
        <% } %>
      </div>
    </div>
  <% }) %>
</section>

<script>
  document.querySelectorAll('.tab-btn').forEach(btn => {
    btn.addEventListener('click', () => {
      const target = btn.getAttribute('data-target');
      document.querySelectorAll('.tab-btn').forEach(b => {
        b.classList.remove('active');
        b.setAttribute('aria-selected', 'false');
        b.style.background = '#fff';
      });
      btn.classList.add('active');
      btn.setAttribute('aria-selected', 'true');
      btn.style.background = '#F4F7F0';

      document.querySelectorAll('.gallery-grid').forEach(g => {
        if (g.dataset.section === target) { g.classList.remove('hide'); g.classList.add('show'); }
        else { g.classList.remove('show'); g.classList.add('hide'); }
      });
    });
  });
</script>

<style>
  .hide{ display:none; }
  .show{ display:block; }
  .tab-btn.active{ background:#F4F7F0 !important; }
</style>


<!-- safe lightbox (no empty src) -->
<div id="lightbox" hidden aria-hidden="true"></div>
<img id="lightbox-img" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==" alt="" hidden>


<!-- Minimal Lightbox (no empty-src images, created on demand) -->
<div id="lb" class="lb" hidden aria-hidden="true" role="dialog" aria-label="نمایش تصویر">
  <button type="button" class="lb-close" aria-label="بستن" onclick="closeLightbox()">×</button>
</div>

<style>
  .lb[hidden]{ display:none; }
  .lb{
    position:fixed; inset:0; z-index:99999;
    display:flex; align-items:center; justify-content:center;
    background:rgba(0,0,0,.75); padding:10px;
    cursor:zoom-out;
  }
  .lb img{
    max-width:96vw; max-height:92vh; border-radius:12px;
    display:block;
  }
  .lb-close{
    position:absolute; top:14px; left:16px;
    background:transparent; border:none; color:#fff;
    font-size:28px; cursor:pointer; line-height:1;
  }
</style>

<script>
  // Open with a real src (no empty src placeholders)
  window.openLightbox = function(src){
    const lb = document.getElementById('lb');
    let img = lb.querySelector('img');
    if (!img) {
      img = document.createElement('img');
      img.alt = "";
      lb.appendChild(img);
    }
    img.src = src;
    lb.hidden = false;
    lb.setAttribute('aria-hidden','false');
  };

  window.closeLightbox = function(){
    const lb = document.getElementById('lb');
    lb.hidden = true;
    lb.setAttribute('aria-hidden','true');
  };

  // Close on overlay click (but not when clicking the image)
  document.getElementById('lb').addEventListener('click', (e)=>{
    if (e.target.id === 'lb') closeLightbox();
  });

  // Close on ESC
  document.addEventListener('keydown', (e)=>{
    if (e.key === 'Escape') closeLightbox();
  });
</script>
